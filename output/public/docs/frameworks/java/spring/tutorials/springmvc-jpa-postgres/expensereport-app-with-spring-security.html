<!DOCTYPE html>
<!--[if IE]>  <![endif]-->
<!--[if lt IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie6"> <![endif]-->
<!--[if IE 7 ]> <html lang="en" dir="ltr" class="no-js old_ie ie7"> <![endif]-->
<!--[if IE 8 ]> <html lang="en" dir="ltr" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]> <html lang="en" dir="ltr" class="no-js ie9"> <![endif]-->
<html lang='en' xmlns:og='http://ogp.me/ns#'>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<meta content='VMware' name='author'>
<meta content='Copyright VMware 2011. All Rights Reserved.' name='copyright'>
<meta content='juhk3p2B-UhzEjLXtqFwDMVLo5Lmy4ZP-zVe7Gxo2Dw' name='google-site-verification'>
<meta content='en-us' http-equiv='Content-Language'>
<meta content='false' http-equiv='imagetoolbar'>
<meta content='true' name='MSSmartTagsPreventParsing'>
<meta content='all' name='robots'>
<meta content='147862838623179' property='fb:app_id'>
<meta content='website' property='og:type'>
<meta content='https://docs.cloudfoundry.com/frameworks/java/spring/tutorials/springmvc-jpa-postgres/expensereport-app-with-spring-security.html' property='og:url'>
<meta content='https://docs.cloudfoundry.com/images/cf100.png' property='og:image'>
<meta content='Cloud Foundry | Spring MVC App with Spring Security' property='og:title'>
<meta content='Adding Spring Security to the ExpenseReport App' property='og:description'>
<meta content='en_US' property='og:locale'>
<title>Cloud Foundry | Spring MVC App with Spring Security</title>
<link href='/docs/stylesheets/print.css' media='print' rel='stylesheet' type='text/css'>
<link href='/docs/stylesheets/master.css' media='screen' rel='stylesheet' type='text/css'>
<link href='favicon.ico' rel='shortcut icon'>
<link href='/docs/stylesheets/uv_active4d.css' rel='stylesheet' type='text/css'>
<link href='/docs/stylesheets/documentation.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/docs/stylesheets/pygments.css' media='screen' rel='stylesheet' type='text/css'>
<script src='/docs/js/jquery-1.6.4.min.js' type='text/javascript'></script>
<script src='/docs/js/documentation.js' type='text/javascript'></script>
<script src='/docs/js/jquery.easing.js' type='text/javascript'></script>
<script src='/docs/js/jquery.social.share.1.2.min.js' type='text/javascript'></script>
<!--[if lt IE 9 ]> <link href="/docs/stylesheets/ie.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<!--[if lt IE 8 ]> <link href="/docs/stylesheets/ie7.css" media="screen" rel="stylesheet" type="text/css" /> <![endif]-->
<link href='/docs/stylesheets/master-cf.css' media='screen' rel='stylesheet' type='text/css'>
</head>
<body class='api'>
<div class='wrapper'>
<div class='container' id='header'>
<div class='site-wrap'>
<div class='container'>
<div class='span-6 logo-wrap'>
<a href='http://www.cloudfoundry.com'>
<img alt="Cloud Foundry: The Industry's First Open Platform As A Service" height='70' src='/docs/images/logo_header_cloudfoundry.png' width='373'>
<span class='replaced'>Cloud Foundry: The Industry's First Open Platform As A Service</span>
</img>
</a>
</div>
<div class='span-9 last'>
<div class='right'>
<form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input' name='q' placeholder='search' type='text' value=''>
</form>
<ul class='super-nav'>
<li>
<a href='http://my.cloudfoundry.com/signup'>Get an Account</a>
</li>
<li>
<a href='http://my.cloudfoundry.com/micro'>Download Micro</a>
</li>
<li>
<a href='http://support.cloudfoundry.com' rel='external' target='_blank'>Support</a>
</li>
<li>
<a href='http://status.cloudfoundry.com' target='_blank'>Status</a>
</li>
</ul>
</div>
<div id='nav'>
<ul>
<li class='selected'>
<a href='/docs/getting-started.html'>Get Started</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/partners'>Partners</a>
</li>
<li>
<a href='http://blog.cloudfoundry.com'>Blog</a>
</li>
<li>
<a href='http://www.cloudfoundry.com/about'>About</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='main'>
<div class='content-wrap'>
<div class='header-wrap clearfix'>
<div class='site-wrap'>
<h1>Frameworks</h1>
<p class='sub-head'>Spring MVC App with Spring Security</p>
</div>
</div>
<div class='site-wrap'>
<div class='container content'>
<div class='span-15 prepend-top'>
<div class='span-4'>
<div class='sub-nav'>
<p>
<strong>
<a href='/docs/getting-started.html'>Getting Started</a>
</strong>
Quick steps to deploy your app.
</p>
<form action='http://www.cloudfoundry.com/search' class='search-form-docs' method='get' onsubmit='return submitQuery()'>
<input autocomplete='off' class='search-input-docs' name='q' placeholder='search docs' type='text' value='more:docs'>
</form>
<br>
<br>
<div class='sidebar-shell' id='js-sidebar'>
<div class='js-accordion-list sidebar-module'>
<ul>
<li class='js-topic'>
<h3>
<a href='#'>Frameworks & Languages</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/frameworks.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/java/spring/spring.html'>Spring</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/java/spring/spring-insight.html'>Spring Insight</a>
</li>
<li>
<a href='/docs/frameworks/java/spring/tutorials/springmvc-jpa-postgres/spring-getting-started-with-sts.html'>Spring MVC using JPA with PostgreSQL</a>
<ul class='spring-subguides'>
<li>
<a href='/docs/frameworks/java/spring/tutorials/springmvc-jpa-postgres/springmvc-template-project.html'>1. Create a Spring MVC Hello World Application</a>
</li>
<li>
<a href='/docs/frameworks/java/spring/tutorials/springmvc-jpa-postgres/spring-expensereport-app-tutorial.html'>2. Create a Spring MVC App with PostgreSQL</a>
</li>
<li>
<a href='/docs/frameworks/java/spring/tutorials/springmvc-jpa-postgres/expensereport-app-with-spring-security.html'>3. Add Spring Security to Spring MVC App</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/java/spring/grails.html'>Grails</a>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/scala/scala.html'>Scala</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/scala/lift.html'>Lift</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/play/play.html'>Play</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/play/java-getting-started.html'>Java Getting Started</a>
</li>
<li>
<a href='/docs/frameworks/play/scala-getting-started.html'>Scala Getting Started</a>
</li>
<li>
<a href='/docs/frameworks/play/java-mysql.html'>Java App with MySQL</a>
</li>
<li>
<a href='/docs/frameworks/play/java-postgresql.html'>Java App with PostgreSQL</a>
</li>
<li>
<a href='/docs/frameworks/play/java-mongodb.html'>Java App with MongoDB</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/nodejs/nodejs.html'>Node.js</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/nodejs/nodeAutoReconfig.html'>Configuration</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/frameworks/ruby/ruby-rails-sinatra.html'>Ruby, Rails, Sinatra</a>
<ul class='js-subguides'>
<li>
<a href='/docs/frameworks/ruby/ruby.html'>Overview</a>
</li>
<li>
<a href='/docs/frameworks/ruby/ruby-cf.html'>Things to Know</a>
</li>
<li>
<a href='/docs/frameworks/ruby/installing-ruby.html'>Installing Ruby</a>
</li>
<li>
<a href='/docs/frameworks/ruby/ruby-simple.html'>Creating an App</a>
</li>
<li>
<a href='/docs/frameworks/ruby/rails-3-0.html'>Rails 3.0</a>
</li>
<li>
<a href='/docs/frameworks/ruby/rails-3-1.html'>Rails 3.1 and 3.2</a>
</li>
<li>
<a href='/docs/frameworks/ruby/sinatra.html'>Sinatra</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Infrastructure</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/infrastructure/overview.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/docs/infrastructure/micro/mcf.html'>MCF</a>
<ul class='js-subguides'>
<li>
<a href='/docs/infrastructure/micro/installing-mcf.html'>Installing MCF</a>
</li>
<li>
<a href='/docs/infrastructure/micro/using-mcf.html'>Using MCF</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Services</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/services.html'>Overview</a>
</li>
<li class='js-subtopic'>
<a href='/docs/services/mongodb/mongodb.html'>MongoDB</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/mongodb/grails-mongodb.html'>Grails</a>
</li>
<li>
<a href='/docs/services/mongodb/nodejs-mongodb.html'>Node.js</a>
</li>
<li>
<a href='/docs/services/mongodb/ruby-mongodb.html'>Ruby</a>
</li>
<li>
<a href='/docs/services/mongodb/ruby-mongodb-gridfs.html'>GridFS</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/mysql/mysql-overview.html'>MySQL</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/mysql/mysql.html'>Introduction</a>
</li>
<li>
<a href='/docs/services/mysql/grails-mysql.html'>Grails</a>
</li>
<li>
<a href='/docs/services/mysql/ruby-mysql.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/rabbitmq/rabbitmq.html'>RabbitMQ</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/rabbitmq/faq-rabbitmq.html'>FAQ</a>
</li>
<li>
<a href='/docs/services/rabbitmq/nodejs-rabbitmq.html'>Node.js</a>
</li>
<li>
<a href='/docs/services/rabbitmq/ruby-rabbitmq.html'>Ruby</a>
</li>
<li>
<a href='/docs/services/rabbitmq/spring-rabbitmq.html'>Spring</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/redis/redis.html'>Redis</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/redis/ruby-redis.html'>Ruby</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/services/postgres/postgres.html'>vFabric Postgres</a>
<ul class='js-subguides'>
<li>
<a href='/docs/services/postgres/postgres-ruby.html'>Ruby</a>
</li>
</ul>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Tools</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/tools/vmc/vmc.html'>VMC</a>
<ul class='js-subguides'>
<li>
<a href='/docs/tools/vmc/installing-vmc.html'>Installing</a>
</li>
<li>
<a href='/docs/tools/vmc/debugging.html'>Debugging</a>
</li>
<li>
<a href='/docs/tools/vmc/vmc-quick-ref.html'>Quick Reference</a>
</li>
<li>
<a href='/docs/tools/vmc/vmc-non-interactive.html'>Non-Interactive Mode</a>
</li>
<li>
<a href='/docs/tools/vmc/caldecott.html'>Caldecott</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/tools/STS/sts-eclipse.html'>STS & Eclipse</a>
<ul class='js-subguides'>
<li>
<a href='/docs/tools/STS/configuring-STS.html'>Configuring</a>
</li>
<li>
<a href='/docs/tools/STS/debugging-CF-Eclipse.html'>Debugging</a>
</li>
<li>
<a href='/docs/tools/STS/deploying-CF-Eclipse.html'>Deploying</a>
</li>
<li>
<a href='/docs/tools/STS/remote-CF-Eclipse.html'>Remote Access</a>
</li>
</ul>
</li>
<li class='js-subtopic'>
<a href='/docs/tools/gallery/box.html'>Box Integration</a>
</li>
<li class='js-subtopic'>
<a href='/docs/tools/deploying-apps.html'>Deploying Apps</a>
</li>
</ul>
</li>
<li class='js-topic'>
<h3>
<a href='#'>Samples</a>
</h3>
<ul class='js-guides'>
<li class='js-subtopic'>
<a href='/docs/samples/samples.html'>Sample Apps</a>
</li>
<li class='js-subtopic'>
<a href='/docs/samples/cool-apps.html'>Cool Apps</a>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<strong>
<a href='/docs/faq.html'>FAQ</a>
</strong>
Frequently asked questions.
</p>
<p>
<strong>
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' target='_blank'>Forums</a>
</strong>
Join the conversation.
</p>
<p>
<strong>
<a href='http://webinars.cloudfoundry.com'>Webinars</a>
</strong>
Learn more.
</p>
</div>
<p class='forgot_pass'>
<a href='http://my.cloudfoundry.com/passwd'>Forgot password?</a>
</p>
</div>
<div class='span-11 last'>
<h2>Adding Spring Security to the ExpenseReport App</h2>
<p class='tags'>
<strong>Tags:</strong>
<span>
<a href="/docs/tags/spring" rel="tag">spring</a><a href="/docs/tags/sts" rel="tag">sts</a><a href="/docs/tags/tomcat" rel="tag">tomcat</a><a href="/docs/tags/maven" rel="tag">maven</a><a href="/docs/tags/spring-security" rel="tag">spring-security</a>
</span>
</p>
<p class='timestamp'>
<strong>Last Updated:</strong>
<span>
2012-12-07
</span>
</p>
<div id='social-share'></div>
<h2 id="introduction">Introduction</h2>
<p>Spring Security is a customizable authentication and access service framework for server side Java-based enterprise software applications. The Spring security OAuth provides a method for making authenticated HTTP requests using a token - an identifier used to denote an access grant with specific scope, duration, and other attributes. Tokens are issued to third-party clients by an authorization server with the approval of the resource owner.  Instead of sharing their credentials with the client, resource owners grant access by authenticating directly with the authorization server which in turn issues a token to the client. The client uses the token (and optional secret) to authenticate with the resource server and gain access.</p>

<p>For example, a web user (resource owner) can grant a printing service (client) access to his protected photos stored at a photo sharing service (resource server) without sharing his username and password with the printing service. Instead, he authenticates directly with the photo sharing service (authorization server) which issues the printing service delegation-specific credentials.</p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Before you begin this tutorial, you should:</p>

<ol>
<li>Be familiar working with STS or Eclipse.</li>
</ol><h3 id="setup-exercise3-starter">Setup: Exercise3-Starter</h3>
<p>Import the source code from the downloaded folder Exercise3-Starter as given. Open STS, Select <strong>File &gt; Import &gt; Maven &gt; Existing Maven Projects</strong> and select Exercise3-Starter folder.</p>

<p><img src="/docs/images/spring_tutorial/import-maven-project-step1.png" alt="maven-import-step1"></p>

<p><img src="/docs/images/spring_tutorial/import-maven-project-step3.png" alt="maven-import-step2"></p>

<h2 id="adding-spring-security-to-the-expensereport-app">Adding Spring Security to the ExpenseReport App</h2>
<p>This section will teach you how to integrate Spring Security into the ExpenseReport Application. These are the required dependencies to be added into pom.xml:</p>
<pre><code class="language-xml"><span class="nt">&lt;dependency&gt;</span>
 <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
 <span class="nt">&lt;artifactId&gt;</span>spring-security-core<span class="nt">&lt;/artifactId&gt;</span>
 <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
 
<span class="nt">&lt;dependency&gt;</span>
 <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
 <span class="nt">&lt;artifactId&gt;</span>spring-security-web<span class="nt">&lt;/artifactId&gt;</span>
 <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
  
<span class="nt">&lt;dependency&gt;</span>
 <span class="nt">&lt;groupId&gt;</span>org.springframework.security<span class="nt">&lt;/groupId&gt;</span>
 <span class="nt">&lt;artifactId&gt;</span>spring-security-config<span class="nt">&lt;/artifactId&gt;</span>
 <span class="nt">&lt;version&gt;</span>3.0.5.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>

<h2 id="enabling-spring-security">Enabling Spring Security</h2>
<p>Go over the following steps to enable Spring Security:</p>

<ol>
<li>
    <p>Add a <strong>DelegatingFilterProxy</strong> in <code>src/main/webapp/WEB-INF/web.xml</code></p>
  </li>
  <li>
    <p>Create a custom XML configuration named spring-security.xml in <code>src/main/webapp/WEB-INF</code></p>
  </li>
</ol><p>In web.xml, declare an instance of a DelegatingFilterProxy. This will filter the requests depending on the declared url-pattern.</p>

<pre><code class="language-xml"><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span></code></pre>

<p>In spring-security.xml, define the Web/HTTP security configuration by adding an HTTP tag. Also define the URL pattern to be intercepted. Add the “jdbc-user service” tag and define the query to get the user and authorities data from the database.</p>

<ol>
<li>
    <p>To access the application, the user must be either <code>ROLE_USER</code> or <code>ROLE_MANAGER</code>. To validate this function, add <code>&lt;intercept-url pattern="/docs/" access="hasAnyRole('ROLE_USER','ROLE_MANAGER')"/docs/&gt;</code>.</p>
  </li>
  <li>
    <p>Since only the manager is allowed to approve expenses, restrict access to him alone by adding <code>&lt;intercept-url pattern="/docs/expenses/approvals" access="hasRole('ROLE_MANAGER')"/docs/&gt;</code>.</p>
  </li>
</ol><pre><code class="language-xml"><span class="nt">&lt;beans:beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/security"</span>
    <span class="na">xmlns:beans=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
    <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans</span>
<span class="s">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">    http://www.springframework.org/schema/security</span>
<span class="s">    http://www.springframework.org/schema/security/spring-security-3.0.3.xsd"</span><span class="nt">&gt;</span>
    
    <span class="nt">&lt;http</span> <span class="na">auto-config=</span><span class="s">"true"</span> <span class="na">use-expressions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/login"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/logout"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/signup**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/resources/**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/favicon**"</span> <span class="na">filters=</span><span class="s">"none"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/"</span> <span class="na">access=</span><span class="s">"hasAnyRole('ROLE_USER','ROLE_MANAGER')"</span><span class="err">/docs</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/expenses/approvals"</span> <span class="na">access=</span><span class="s">"hasRole('ROLE_MANAGER')"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/expenses/**/state**"</span> <span class="na">access=</span><span class="s">"hasRole('ROLE_MANAGER')"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;intercept-url</span> <span class="na">pattern=</span><span class="s">"/docs/**"</span> <span class="na">access=</span><span class="s">"isAuthenticated()"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;form-login</span> <span class="na">login-page=</span><span class="s">"/docs/login"</span> <span class="na">default-target-url=</span><span class="s">"/docs/"</span>
            <span class="na">authentication-failure-url=</span><span class="s">"/docs/loginfailed"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;logout</span> <span class="na">logout-success-url=</span><span class="s">"/docs/logout"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;session-management</span> <span class="na">invalid-session-url=</span><span class="s">"/docs/sessiontimeout"</span> <span class="nt">&gt;</span>
            <span class="nt">&lt;concurrency-control</span> <span class="na">max-sessions=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/session-management&gt;</span>
    <span class="nt">&lt;/http&gt;</span>
    <span class="nt">&lt;authentication-manager&gt;</span>
        <span class="nt">&lt;authentication-provider&gt;</span>
            <span class="nt">&lt;jdbc-user-service</span> <span class="na">data-source-ref=</span><span class="s">"dataSource"</span>
               <span class="na">users-by-username-query=</span><span class="s">"</span>
<span class="s">                     select username,password,enabled</span>
<span class="s">                     from users where username=?"</span>
               <span class="na">authorities-by-username-query=</span><span class="s">"</span>
<span class="s">                     select u.username, r.rolename from users u, role r</span>
<span class="s">                     where u.role_roleid = r.roleid and u.username =?  "</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/authentication-provider&gt;</span>
    <span class="nt">&lt;/authentication-manager&gt;</span>
<span class="nt">&lt;/beans:beans&gt;</span></code></pre>

<p>To load this file as a part of configuration add <strong>@ImportResource(“/docs/WEB-INF/spring-security.xml”)</strong> in ComponentConfig class.</p>

<p>Create LoginController in the <code>com.springsource.html5expense.contoller</code> package and add mapping for login, logout, loginfailed, and signup. The login.jsp has two input elements for username and password (j_username and j_password). These are Spring’s placeholder names for username and password, respectively.
When the form is submitted, it will be sent to the following action URL: j_spring_security_check.</p>

<p>Find the LoginController code <a href="/docs/frameworks/java/spring/tutorials/springmvc-jpa-postgres/code/logincontroller.html">here</a>.</p>

<h2 id="authentication-flow">Authentication Flow</h2>
<ul>
<li>
    <p>Once you have added Spring security into the ExpenseReport App, it will ensure that the user has been authenticated and authorized to access the resource. The below figure shows how the user interacts with the application.</p>

    <p><img src="/docs/images/spring_tutorial/Spring-security-flow.png" alt="sequence-flow" width="80%"></p>
  </li>
</ul><h2 id="check-point">Check Point</h2>
<ol>
<li>
    <p>Select project, drag it down and drop into your VMware vFabric tc server listed in the bottom left Server window.</p>
  </li>
  <li>
    <p>Select VMware vFabric tc server and press <strong>CTRL+ALT+R</strong> to run the server.</p>
  </li>
  <li>
    <p>Once the Server starts, open your browser and enter application URL : <code>http://localhost:8080/html5expense/expenses</code>. This time you will be automatically redirected to the login page.</p>

    <p><img src="/docs/images/spring_tutorial/localhost_login.png" alt="STS Fabric Server.png"></p>
  </li>
</ol><h2 id="complete-application-code">Complete Application Code</h2>
<p>If you are getting any errors, download the Exercise3-Complete code and import into STS.</p>

<h2 id="deploying-to-cloud-foundry">Deploying to Cloud Foundry</h2>
<ul>
<li>To learn more about deploying Spring App with PostgreSQL to Cloud Foundry, please refer <a href="/docs/frameworks/java/spring/tutorials/springmvc-jpa-postgres/springmvc-app-with-postgresql-deployment-to-cloudfoundry.html">here</a>.</li>
</ul><p><a class="button-plain" style="padding: 3px 15px;" href="/docs/frameworks/java/spring/tutorials/springmvc-jpa-postgres/spring-expensereport-app-tutorial.html">Prev</a></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class='container' id='footer'>
<div class='site-wrap'>
<div class='row'>
<div class='span-3 social-icons'>
<a class='twitter replaced' href='http://twitter.com/cloudfoundry' rel='external' target='_blank'>Twitter</a>
<a class='facebook replaced' href='http://facebook.com/cloudfoundry' rel='external' target='_blank'>Facebook</a>
<a class='youtube replaced' href='http://www.youtube.com/cloudfoundry' rel='external' target='_blank'>YouTube</a>
</div>
<div class='prepend-2 span-5'>
<p>
<a href='http://www.cloudfoundry.com/faq'>FAQ</a>
|
<a href='http://stackoverflow.com/questions/tagged/cloudfoundry' rel='external'>Forums</a>
|
<a href='http://blog.cloudfoundry.com' rel='external'>Blog</a>
|
<a href='http://www.cloudfoundry.com/jobs'>Jobs</a>
|
<a href='http://www.cloudfoundry.com/legal'>Legal</a>
|
<a href='http://www.cloudfoundry.com/terms'>Terms</a>
|
<a href='http://www.vmware.com/help/privacy.html' rel='external' target='_blank'>Privacy</a>
</p>
</div>
<div class='span-5 last right'>
<p>Copyright &copy; 2012 VMware, Inc. All rights reserved.</p>
</div>
</div>
</div>
</div>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-22181585-10']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    
    $(document).ready(function() {
      $('#social-share').dcSocialShare({
        buttonSize: 'horizontal',
        buttons: 'facebook,twitter,plusone,linkedin',
        location: 'top',
        align: 'right',
        offsetLocation: 260,
        offsetAlign: 100,
        width: 80,
        center: true,
        centerPx: 600,
        disableFloat: true,
        tabText: '',
        twitterId: 'cloudfoundry'
      });
    });
  //]]>
</script>
</body>
</html>
